exports.id = "main";
exports.modules = {

/***/ "./src/server/server.js":
/*!******************************!*\
  !*** ./src/server/server.js ***!
  \******************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _build_contracts_FlightSuretyApp_json__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../build/contracts/FlightSuretyApp.json */ \"./build/contracts/FlightSuretyApp.json\");\nvar _build_contracts_FlightSuretyApp_json__WEBPACK_IMPORTED_MODULE_0___namespace = /*#__PURE__*/Object.assign({}, _build_contracts_FlightSuretyApp_json__WEBPACK_IMPORTED_MODULE_0__, {\"default\": _build_contracts_FlightSuretyApp_json__WEBPACK_IMPORTED_MODULE_0__});\n/* harmony import */ var _build_contracts_FlightSuretyData_json__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../build/contracts/FlightSuretyData.json */ \"./build/contracts/FlightSuretyData.json\");\nvar _build_contracts_FlightSuretyData_json__WEBPACK_IMPORTED_MODULE_1___namespace = /*#__PURE__*/Object.assign({}, _build_contracts_FlightSuretyData_json__WEBPACK_IMPORTED_MODULE_1__, {\"default\": _build_contracts_FlightSuretyData_json__WEBPACK_IMPORTED_MODULE_1__});\n/* harmony import */ var _config_json__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./config.json */ \"./src/server/config.json\");\nvar _config_json__WEBPACK_IMPORTED_MODULE_2___namespace = /*#__PURE__*/Object.assign({}, _config_json__WEBPACK_IMPORTED_MODULE_2__, {\"default\": _config_json__WEBPACK_IMPORTED_MODULE_2__});\n/* harmony import */ var web3__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! web3 */ \"web3\");\n/* harmony import */ var web3__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(web3__WEBPACK_IMPORTED_MODULE_3__);\n/* harmony import */ var express__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! express */ \"express\");\n/* harmony import */ var express__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(express__WEBPACK_IMPORTED_MODULE_4__);\n\n\n\n\n // Flight status codees\n\nvar STATUS_CODE_UNKNOWN = 0;\nvar STATUS_CODE_ON_TIME = 10;\nvar STATUS_CODE_LATE_AIRLINE = 20;\nvar STATUS_CODE_LATE_WEATHER = 30;\nvar STATUS_CODE_LATE_TECHNICAL = 40;\nvar STATUS_CODE_LATE_OTHER = 50;\nvar ORACLES_COUNT = 30;\nvar STATUSCODES = [STATUS_CODE_UNKNOWN, STATUS_CODE_ON_TIME, STATUS_CODE_LATE_AIRLINE, STATUS_CODE_LATE_WEATHER, STATUS_CODE_LATE_TECHNICAL, STATUS_CODE_LATE_OTHER]; // Track all registered oracles\n\nvar oracles = {};\nvar config = _config_json__WEBPACK_IMPORTED_MODULE_2__['localhost'];\nvar web3 = new web3__WEBPACK_IMPORTED_MODULE_3___default.a(new web3__WEBPACK_IMPORTED_MODULE_3___default.a.providers.WebsocketProvider(config.url.replace('http', 'ws')));\nweb3.eth.defaultAccount = web3.eth.accounts[0];\nvar flightSuretyApp = new web3.eth.Contract(_build_contracts_FlightSuretyApp_json__WEBPACK_IMPORTED_MODULE_0__.abi, config.appAddress);\nvar flightSuretyData = new web3.eth.Contract(_build_contracts_FlightSuretyData_json__WEBPACK_IMPORTED_MODULE_1__.abi, config.dataAddress);\nweb3.eth.getAccounts().then(function (accounts) {\n  console.log(\"length :\" + accounts.length);\n  flightSuretyData.methods.authorizeCaller(config.appAddress).send({\n    from: accounts[0]\n  }).then(function (result) {\n    console.log(\"appAddress registered as the authorized contract of dataContract\");\n  })[\"catch\"](function (error) {\n    console.log(\"Error in authorizing appcontract. \" + error);\n  });\n  flightSuretyApp.methods.REGISTRATION_FEE().call().then(function (fee) {\n    var _loop = function _loop(a) {\n      flightSuretyApp.methods.registerOracle().send({\n        from: accounts[a],\n        value: fee,\n        gas: 4500000\n      }).then(function (result) {\n        flightSuretyApp.methods.getMyIndexes().call({\n          from: accounts[a]\n        }).then(function (indices) {\n          oracles[accounts[a]] = indices;\n          console.log(\"Oracle registered: \" + accounts[a] + \" indices:\" + indices);\n        });\n      })[\"catch\"](function (error) {\n        console.log(\"Error while registering oracles: \" + accounts[a] + \" Error: \" + error);\n      });\n    };\n\n    for (var a = 1; a < ORACLES_COUNT; a++) {\n      _loop(a);\n    }\n  });\n});\nflightSuretyApp.events.FlightStatusInfo({\n  fromBlock: 0\n}, function (error, event) {\n  if (error) console.log(error);else {\n    console.log(\"Received flightstatusInfo event:  \" + JSON.stringify(event));\n  }\n});\nflightSuretyApp.events.OracleRequest({\n  fromBlock: 0\n}, function (error, event) {\n  if (error) console.log(error);else {\n    var key;\n    var indexes;\n\n    (function () {\n      var index = event.returnValues.index;\n      var airline = event.returnValues.airline;\n      var flight = event.returnValues.flight;\n      var timestamp = event.returnValues.timestamp; //let randomstatusCode = STATUSCODES[Math.floor(Math.random()*STATUSCODES.length)];\n      //console.log(\"statuscode is:\" + randomstatusCode);\n\n      for (key in oracles) {\n        indexes = oracles[key];\n\n        if (indexes.includes(index)) {\n          (function () {\n            var randomstatusCode = STATUS_CODE_LATE_AIRLINE; //STATUSCODES[Math.floor(Math.random()*STATUSCODES.length)];\n\n            flightSuretyApp.methods.submitOracleResponse(index, airline, flight, timestamp, randomstatusCode).send({\n              from: key,\n              gas: 4500000\n            }).then(function (result) {\n              console.log(\"Oracle response sent with statuscode: \" + randomstatusCode + \" for \" + flight + \" and index:\" + index);\n            })[\"catch\"](function (error) {\n              console.log(\"Error while sending Oracle response  for \" + flight + \" Error:\" + error);\n            });\n          })();\n        }\n      } //console.log(event);\n\n    })();\n  }\n});\nvar app = express__WEBPACK_IMPORTED_MODULE_4___default()();\napp.get('/api', function (req, res) {\n  res.send({\n    message: 'An API for use with your Dapp!'\n  });\n});\n/* harmony default export */ __webpack_exports__[\"default\"] = (app);\n\n//# sourceURL=webpack:///./src/server/server.js?");

/***/ })

};